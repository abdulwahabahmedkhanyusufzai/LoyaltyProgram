<!-- sections/loyalty-dashboard.liquid -->
<div class="loyalty-dashboard">
  
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <h2>Loyalty Program</h2>
    <p>Hi {{ customer.first_name | default: 'Customer' }}, welcome back.</p>
  </div>

  <!-- Loyalty Rating / Points Summary -->
  <div class="loyalty-rating">
    <div class="points-summary">
      <h3>Points Summary</h3>
      <p class="tier-text">
        You're {{ section.settings.points_to_next_tier }} points away from Bronze Tier
      </p>

      <div class="points-info">
        <h1>{{ section.settings.total_points }}</h1>
        <p>Total Points</p>
      </div>

      <!-- Tier Progress -->
      <div class="progress-board">
        <div class="tier-progress">
          <div class="tiers">
            {% assign tiers_raw = "Bronze:bronze.png:false;Silver:silver.png:true;Gold:gold.png:false;Platinum:gem.png:false" %}
            {% assign tiers_list = tiers_raw | split: ';' %}
            {% for tier_item in tiers_list %}
              {% assign parts = tier_item | split: ':' %}
              {% assign tier_name = parts[0] %}
              {% assign tier_img = parts[1] %}
              {% assign tier_active = parts[2] %}
              <span class="tier {% if tier_active == 'true' %}active{% endif %}">
                <img width="40" height="40" style="height:40px;" src="https://cdn.shopify.com/s/files/1/0921/8428/1416/files/{{ tier_img }}?v=1760793539">
                {{ tier_name }}
              </span>
            {% endfor %}
          </div>

          <div class="tier-bar">
            <div class="tier-fill" style="width: {{ section.settings.progress_percent }}%;"></div>
          </div>
        </div>

        <!-- Actions -->
        <div class="points-actions">
          <button class="earn-btn">Shop & Earn More</button>
          <button class="redeem-btn">Redeem Points</button>
        </div>
      </div>
    </div>

    {% render 'loyalty-sale-product' %}
  </div>

  <!-- Recent Transactions -->
  <div class="loyalty-table">
    <div class="transactions">
      <h3>Recent Transactions</h3>
      <div class="points-actions3">
        <button class="redeem-btn">Redeem Points</button>
        <button class="earn-btn">Shop & Earn More</button>
      </div>
    </div>

    <div class="order-history">
      <table class="order-history-table">
        <thead>
          <tr>
            <th>DATE</th>
            <th>ACTION</th>
            <th>DESCRIPTION</th>
            <th>AMOUNT OF</th>
            <th>POINTS (+/-)</th>
          </tr>
        </thead>
        <tbody>
          {% for order in customer.orders limit:10 %}
            <tr>
              <td>{{ order.created_at | date: '%b %d, %Y' }}</td>
              <td><span class="badge {{ order.financial_status }}">{{ order.financial_status_label }}</span></td>
              <td><a href="{{ order.customer_url }}">{{ order.name }}</a></td>
              <td>{{ order.total_price | money }}</td>
              <td><span class="{{ order.fulfillment_status }}">{{ order.fulfillment_status_label }}</span></td>
            </tr>
          {% else %}
            <tr>
              <td colspan="5">You haven't placed any orders yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- JS / CSS -->
{{ 'loyalty-dashboard.css' | asset_url | stylesheet_tag }}
<script type="module" src="{{ 'loyalty-dashboard.js' | asset_url }}"></script>
{{ 'loyalty_program.css' | asset_url | stylesheet_tag }}
<script type="module" src="{{ 'loyalty_program.js' | asset_url }}"></script>

{% schema %}
{
  "name": "Loyalty Dashboard",
  "target": "section",
  "settings": [
    { "type": "number", "id": "total_points", "label": "Total Points", "default": 55 },
    { "type": "number", "id": "points_to_next_tier", "label": "Points to Next Tier", "default": 5 },
    { "type": "number", "id": "progress_percent", "label": "Progress Percent", "default": 35 }
  ]
}
{% endschema %}
